language: generic
jobs:
  include:
  - stage: build and test
    os: osx
    osx_image: xcode11.3
    before_script:
    - git clone https://github.com/flutter/flutter.git -b stable
    - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
    - echo "y" | flutter version v1.12.13+hotfix.7
    - flutter packages get
    script:
    - cd ios; pod install; fastlane beta; cd ..
    - git clone https://github.com/apptestai/ci_addon
    - export binary_path="ios/Runner.ipa"
    - export project_id='1106'
    - bash ./ci_addon/step.sh

  - stage: build and test
    os: linux
    language: android
    jdk: oraclejdk8
    android:
      components:
      - tools
      - platform-tools
      - build-tools-29.0.2
      - build-tools-28.0.3
      - android-29
      - android-28
      - android-27
      licenses:
      - android-sdk-license-.+
      - google-gdk-license-.+
    before_script:
    - git clone https://github.com/flutter/flutter.git -b stable
    - export PATH=`pwd`/flutter/bin:`pwd`/flutter/bin/cache/dart-sdk/bin:$PATH
    - echo "y" | flutter version v1.12.13+hotfix.7
    - flutter packages get
    - openssl aes-256-cbc -K $encrypted_64e89481033b_key -iv $encrypted_64e89481033b_iv
      -in keystore.jks.md5.enc -out keystore.jks.md5 -d
    - cat keystore.jks.md5 | base64 --decode > ${HOME}/keystore.jks
    - echo "storeFile=${HOME}/keystore.jks" > android/key.properties
    - echo "storePassword=${KEY_STORE_PASSWORD}" >> android/key.properties
    - echo "keyAlias=${ALIAS}" >> android/key.properties
    - echo "keyPassword=${KEY_PASSWORD}" >> android/key.properties
    script:
    - flutter build apk --release
    - git clone https://github.com/apptestai/ci_addon
    - export binary_path="build/app/outputs/apk/release/app-release.apk"
    - export project_id='1107'
    - bash ./ci_addon/step.sh

env:
  global:
  - secure: txFyzGyrXLV9pjdgpVb3fra8uLEftRCYSIM/9HYoDWH7Lzoej69hcpgvnL4LY3u97tKDVGu0vYLzOcukyw7gBxrjmb8NVf0owWH8XDufHgFUiw2vI6PpqJTRg8ZI09DLLbOjE4tpAA+BWlFhHuze3w5LszD++Xyghb2Ofe+OpngW5Q7nPzlNWQZht9X52tCG76oyCzTp5BJOXPkenaRNaM95omV4xesxp6b/zTQaa3eG64zqoKqh0rkbBhA9yGxuriykFwao3S1MpBfA8T6dwVi17RkDQRDYDbvWhYhcnjwh8bYMieHNTVaw5V08m0YKmtkMjccRuQpBrlpmvx5nt2HN8yN7kqkEZfqdrfCu80v2pxbu/uGnEuCDzw4LpJfVt4gFDZ/uD7SWi7p2o2AHjQtRunFcONMZF2Ls4u6Os/JCfzEHDL3GjDu2geC97s8JiWdJzxcvprUjgnJ0iPgKMl1qc7MEwPwc8chefYFdnpSNceU6X0ojEeZneet6JeuOWDoEwwGMs4NNoOcfjk/WsV/u6DSlK/bsIRTILdAFlEdGnkguJFUH0k0meKAVjjC8ykXABRO5ke9N1vc7V0a4ODuP123Bgx07xpUBfQ92qyYGH8jpR2mDaZb5sOue2PsnSAWGFWsiszJ1IYXBtU675FSFSKnmdsmTkoamJQsgZbY=
  - secure: 1c2/Xdl7/1cqbcB+hwJYy5KjMmzx8GIFG6bLmDe3JdfHhetqjTWB+J7XIVhmRqR4dP6U8m2o0CoVE5g/Y3dLyLADEkpNKnOMJ+mIuu6n/s7IRv849Fk/Gn64UCOp/rvD3TG6JgQ7dkIvjHpo6rjDoV3/dpd47/dUf0hEG4hFUj99pIfVmv3YqtsI5Wc0S+NQEgH+cnXCofPXdaLQhcdx7l7DchkvZRDn+M1zYXgd9GIWpCRbvoI2IVbP4DaakmdJl2IRewEoyhygAgFJuRV82LPYN1EwfCpmecFSdVZsdFA+RcjjhhOir0yZYDFXaAlOVZPTwTZcoFMmTa2XvZ9wh67Rm5oqP6s8vbX/ZcqHVAmA/TwqvPOHrHdSSO1H4ttBtk3rSOI3DsNQSyWHdn68xZe+0ZdOjWrm441M9eQKroUzFEpjZ+rlo9ClLIAt8RyGkskxHi0SZYg5hH2b4AzX6KUDUMeAmIQXGK56s3tBSRIwd9B2ZBPiHGBsvibyXKRrzfxIoAhdkOZyevNwiFxp4KaqtqLHga+RCYFJMUJL5nbr+YX4hTcvQ76W/Ym/+Zl5ZrB3CTg8XeVzIn7CXZ8esWaA01IuFGPS+aWZaBiT260+GekM3ESU2WDuQRqyLLP5pp+DMDEoAB9iBP7jREQQZyt9imXz4B4VZERNm+PsRmc=
  - secure: ABnoZaXm1lbDL1sCx7pJVkHfawHtbiiSBzydwRq4XExELaVjOi9xv8b4PcaQ8UAeC6CzagTGyr+ZDbtp8Cs4OXnT2vpPCBZD93XjyUT4X9Gi/xbs2nukRG4d/dsX84jbQMme+71alM/rjLJAQp7KWm6ftlP/ICbKKVUpdg9rfAy7+VY1l6w2QozNGrcL3STWw2A7tcYRV79TGLs2HmwTiZh3h4yhjuQk7LATdjRsqLkZGVCHzkVS2su6ZiTwIjPl0AHKqSUUQWxvPkn/LZc6rDuvOsIoeGy43EZfXG7Y30f5XCABRdQzXYrOiOPS1TiD6kUeeLH9bwjRGyZ6QBpTkfeFYoDpkiUKrFU8I2o8R3E4Vi1HtHXJNr1fFS8mwUTAX+eBy24FAard5UkbOjDzAK8+E5vI+ZUyKsW8FhV+f7WDCKvZrDUPUwAirDmTawPCOl1sL2dROLSBFMlsZMlXS9z9pBBbiZ99fDOG5fzeAzvbTqAXu+zaCmI1+0V5xJoSAF+uJ/ryn08F8fuM9mCOJtMyZ9SxlFNPnZEe7Fw6X77WT8EHr0E3Ild5nWULC7UJ1rZzo383Ab/Nn1Fv94Mf/bRV7JHfR4rMYyG8ztiXMqR257/aiA0WeB+k9watmZ0d16piA5yt0R/J5U6Hgor2/7E2SrRgv6tYR0dM4B5SKl0=
  - secure: RAn0kJFYU+nksdBp/j22aglgWxP30ikrKjqD2YH7+vt5EiZCQ/P07f5LvAICGGJJjLp8IpH03jx+NJFYTQJ6RCE75uY9eTShMU5CvboK4Zp1AWr9TOKd90ypKPsDXfGH9MQsMeiSlG+BqfuSURhjWSd9s1SU23Rp4FWOhEd3kFrmBRviAaVVWON7yVBHp0yBAbidepKfw+HUj9xXccQJ3n2k5OxlSGHccqXEpzGK+G6v+26v0zpWd26rJY4Dzv6y1jdlWkB60X2tFwKHst6rKk7+598oIkX4NOLMRlhoi7AFTqHaQIuZiNBYhP7/dayoguGFG/uGP8tljn/dBLswzJgPjgp7HPvkXDia5IH6SBnu/d1mo3/VGy+K+bXEyKLio8mYdS05tfHU66B4lnxIkLavmZxfMirW7xfvK9qYG/5D7i2zrjztRim4B6BLhk82vWzUOYoRhKBFF3RbxFS8kWmE/2c/FBB9kxKdOLoDNDDNXnhZEadqVyQU48RCkN21bHDA0D9syEjQIFSeszlCjyhCZneXYDc3WhzXncu032Y6h+D327gN8vybtLgTc1L2Kn+UxAD326KRZpIUeqGKdMSotYhyySuE93Q59D2/nY67Qf9qK2CSydDnHQbuX4DheohuDjiPR+WOoKG9iJjlJQXBl0wah4Utc2R5rGFZq0A=
  - secure: shpqUl+TGrLu5MtNfo6j++L+rYg7mH3i4IYIb1CCCmradmv96NCqsUJCFEEVFj2wFlWGdk09iZrBJHzz0xxfDYEZSgvikkj1quK1TmvXLPrkHnG4efvyFHujXkjTpIY1it9M8y6DGsbZsSl4CqXDlPu0gQ5pacLQpvuh9VlvFDBXaR9LZ36wupQMf6PheP+Z+aKnQ49zqBggc3DgS+qXLfH4UMf5eKHc5dDosBDHnA8z6JuvWIhH37T3LxzlbaF3tfSTel945AYjevQIgE/eA+nbdj1zRk220XjwrWkWdPhIdNHZj8vN/KJJob0YEvSfdTdWMO6rsyjYNYp1lw6mdPoFuUVHuzywsltwA+shouy97p3C6tD1y+lw7aQSZ0x9IF91FtDlUGv79+hT43xwN+yEh8L7fvjqsDeN4cQwoqBLDfFcMhBVnG975098b9PMtzB2uJSRvpH24QTFxiIdmC6TsUr5nykmgbPt8IadTuakcwZyQ6veFjZxmy1bF/9h61K0JN2m72Pv7zY7v2g3AywcYUs0TNNGBowMJO6Y5rN7iI28bG2f+wMyT2zeq97ldTlkhey6XzDn15a+Q2lK8w/UuiuKGRAfepGzIgCadJVXYq6kT3g7AE8zhWdpu6VICvLPzl320QvakXLwYmPUS03wkPMFK8+lQ2AnuOrJ+FI=
  - secure: 2OnMzhZtaNkF9v/vVaFny3OWPN7FnIH+K9FYxcSde/mhx3LsfyjHk28ccaBoS0aL0cpZiYfwi0CEB6OACTPRJmGip8/qYejINNz0VewWuUVursn4obnCSANqoDkd70OuPj9kyjGLrf5Ig4QGzXfspxN+prYBrNUBvJ/tRBo+bhgRgVSxLkIOZHwapkRaR1jYqyKbilwYAy5B0rSgCJHRKsHoIKArBIRdRUL+UVYzghmog/AXOJ+1Jv5inUrcCuNftTjTkPEjFqsBECkk4SheSFN/9JjE1/bgJidLUWg9y2EScmqn4/k7yztnTmAViDpChws6k82FJmzwkzByfYs3dkJ+yTQnha8sCA7MptVgw6r1MCHBzWxMGTDfj9X85vzQCOiFJgUJiktxsLqbwiIgbLBNs4LUEPXf2f9mnD6lCnkp40IBJhC1gEIHuZ0bZfzm36nwwV/wtsD8xp7bjzY7u3YhRYdt7oaBetH7uFQD89k1ycwFBlTQXVa4cUv764Q/bAa9w9g8CvyqgOOf78dQ6CxqhGdT2wEBnczIsomdrag/jC10BRU9kQESQd6/fJwIhacMdIwqgPP0F5azuG4zNfar1t8WdxdzI4cC0dCuRPLtrjiz5QPiuY5cULo9SyFnqB/vhgNzR3ta0DjAUh8SXFdvBYHwKiU3DExwN6A9hp4=
  - secure: aPvmMxylBAivqcW68QlP4KKE6aZfJGIZs5ro9FtKLN+0yBV1XeLGfjmrOifzD4qBZsT/QTITg6e4DmXsEMG9lCS00eR89JNpBPS/gjlKsj71+TlLx0ZkwgRgMaIIN954AAcTdqEFJzfcQIbB5TOwbofFlkFl6vq9jKC+OEzA8C5Zk3jSILgmvid1yGK0jquUfLEbXco6fvLtWudkaf1/5/YHUHdtZ9hgfcHT9TzqQNEA6gIr2t90+M7Em4NNQHzpKUrPuVXfukfvIlJNVEEqhOP21pnQn+gcs68Cag9WQ0dt7RODd+WG8ira+MCyIkLtJ4wMfWaa2VSt46ETOWwMEkCKAAC5MtHiZkBXLhW9OLpU45LxwOfPQgHDcrXdjM2k6NPWFQZ/UGFFQNGmSMhIE6WCWqKaRzkClODrCujPKfiUrERHLJSBFQ07z82w8PZqV9Eocx5w4OvJgV3pb+8hDxK/HMML76VNCHqov2p7LsQ47PuJJQ5fOjvEZOzGbe3USz03G0Qk9kuBk7Q4r47jmwI9/OWSTStNs4n10Jvit/EViIHdramk0a/gUG30P1rBuIvVbbX+WxRDgAf/pbPrb/vFiWBuQ4jGCVmwF8IthYnCzAr5dEtnO/NkvArjkwDxUU9O5cZ452/+FyA6eXwNhOXpGXkrsIBKWUN74mV2E54=
  - secure: 0UmglQZKNaOB/r/YgHIALdKp5ThRMrA6gjvLvWEhB6gQIio8U0nllK3Pbsha8tHiT5JKt30r5SQFuaSGAt0JqHMouVFxOLXznGd/iZKDPxIjtrqhQqMTlB9y/2W4USllSQhBgQtw/ZRyHobAv9z538RnZQ3aEhmSZRaqp3dJIzW49NzrzgWzVjLzKjd9uvA2tsVbbfDnfYlP8PGaZR23JK4V1BUauh0+1Km0C5czmpmOJlUMbalabvRL+nhDfyfHqC40vFGfD2zB5oDS9Jp0JcyhcLgfx/te/EksIFZxO97LSSFJ//mGkMHVCIrtq8IRNUnI9RDcy3ZdLRoHJcZxzwc0R3F9+/IKhmz1/Bfp8ZCCC8u+0tQAG2CdhdQCcx5Z3hyg2jD7UIIL9P2aJsjzUNtZixzePTsJPYIx/bXi7sBg75gIe/AqXquPdx+610T0NSB1s0i/lLXli4QgQwtxjOe6OO1ewYkZJAGa7xDRDDQKU9n1jhI01hZ3CmZ0Cou+oo7XKm1726PTLeoDyrDjq+eX4G7DKWO0sBQznXaaLo2wPuPgUuL2GVoZ0EG7+JokcTeIk0wWMu1HZgBHoDpS7gXT+n3+1rUxyE2ZfjPssAd/gw3r9qWJ/eEjxTbCo5VM7Ts0sCS4WPwWH46jvgOWrJxSnOt3kXR5VMjmWht9AtA=
  - secure: R2rSwg2UnPTIAToP1cldyUtkbstSTLjpIKGRQuoyFUJ+OqT30aytkp1fhygjZrB4XpWBd0qWnExDGZJI/G7yN2PYp7spAbgxTG8guFy6vbCUu9BRr64nj2RPwtYTwCtDe8gGfKEysAHRvsoAHBQQSWPyCCXTPZ8s9JQMA/pQVChJbbQLHZiLSLONBQ/dyX6R5kjWvcAx1edaLN9oc6Z7x71/DtIa8s9YtOuCFIke9hw3MKFPbDRVZhAW/8sgpPAvAkeWuXkNsC9sggCtXox1JI/0CCln7yPitJHintH3/ZqT62aq4NAw+LsQ6FXx3dEIQDhysXmH51YZnteP2gzr6MZKzh7dSWWRa0B6E2xsxUd8dUPGHWGf+FYPp7t64KR1eApTs/WdAgojfIf+Ya84UKeFtLYimb1g45mUTPD70J1WNOV4H1Uu/vhK/fqEN5Yi9zZTizk0gBi5939MejiPS72F/LqRsEo72Bca8Ohp/XPu4US+HPYNM/UIjZQ0hJVyNLe8jErabHAHYS/pIQtdatS808Co9o1Yj4YecUXaFub5TwTQHLa5W2ENJ8N/CWnILWdAgY/4rkxpvQ6hGhedhigrgYU7MDijPfiA/EGY63y7V7gvaj1ddbBDDK4xolN1cOQEHlFDY665QPdVu2tT2KODOXS/ctalUBoqQAKwE0s=
  - secure: eDyOMSwHGOJQZIJBFmcKFIut91I65gh34xL0nPu6NrRv6741jGzAIkbelc7i4+Cyj1lWt4dUjt7cU8E5eegPUKnHTdnZD2We/wyhaj/16g1Psg6RgrRztcMix/llL7Fr6qj5H9VqLooq6K3jnJTEPVaPsz8sPX69cEP5fivIyMmGbEO6DmoDpOIux/jNB4Xl62LMQmK8uE1lKFPlE1m9HlNIIREXYwcHS6ltxTYJNRI0yPF8NmD3n1Th2ILVpjxvbebwdAcBMTAnZ308vvEwzOh725o5OiNL+HfIbRxzvynfj3jCDdwhifGVeMoZLxASMi3ujqUif0UMLXHVu/dEa2pNwhjcpRE5xxHuTvaQB7cc3HZUU/MrwQ7zXsOHitneEWjAexQa6vov2HCst0NHWGGcQ8/K+z4CYgpDXaBxN2aLRe55iCNBnBI+6rRIW30F6V/0qmmfwbe3nhjfZXjFAA3JQUEIsYttdpjhlOzZuuPc4FdMxb0LQKOyQhAHm5SUG0THMXtJrNdk8TqJXFNPmhhU0UEfaewvVGBq0EioJDlHtouk0qCbcbcmy43RHIbb3lzq2pBeQRBuDndF7DYApjepIgr8VPLjdfAzntO/Q5vBdRjTxdez0Sd+5N+ZjaEttO17TzDaS8ved0MEUeiUdEkHXQ7tDLK4ExRXnsXZ7BY=
  - secure: lxIx9qCpF1vfLUZ5N40FmelX0A3ApcvcKEcgi/RXDqOwHuyMYhGa2KOcmmhpvGufkNkcAd0bLg8O78qYfHnft3EpBHdfSlrA97wQhF4FQB8gnhjisNNJXZfmKNXkAEYaBDg3Rd5NhlqjKL5FhEql4TWtPoDueyyfVC98CsKctEgKLkNVVXlfcnvm8UXkA/h+fJHYdecXT54W/UpadYbe0NgYv96inD79UMXgR+myrxUHRusJbr0ajtPW4qN1EG2MACMml2jh3wgFlxt7qZ5tvSQoQ4vwmDnkGF+Umb1QN9QRW9fi9bAcWmOhalmk3aC7oj9hlrb65XqUtF7l00X9PZibyPVeU1OTqr/YiYpOqgXHPWMNPnMrYExmvgNqs8q+cEi41Catr05ce+IstpSIonowoPQfSXnR1YlO3S18loXBqOmwOGGnMCKnuk5ey2qE+a7+c5A4zhpYj6s5KFCmIUqELTs44Jn0gLawXNC9MCtzSRm1b9sBrTh2eT5JRGdoiV9MBa2LiSIgq5yOBcGGnXeH5asyYa7lApTDvTad8+4eeqQ0B/3y6G9OAni6wDIBaVi9GAFhK/iJkwImMVVxOy7mUXhNTGpnnfykSz6cQpypuNVt0FqBQhNCF+rQCy8r2Fy1/Fyj3iiTZtIlosAzqVd9C5A7MPXcIUhHFw1t1nU=
  - secure: rNftteDYVK9BmLKVW+DvuE9tWcJS6iaFQxwLjHDnQ1Q9hoou3f+Cy2x/KKvl1FE9hBme5xBNHA16MnssQAQIdYB8Iif2ygdN//DZnOIkXvLopQJcc207y2VYwk/2q1eYy9fpfka7REtigge97ZPnL6mJYzWGEzMmICHw083aeTBtxb5HjwMTbIDr3VhIYE17nykuWce6cuEB7D1eiNNAhzaVDvPL18dy49CjWUw3AzXAgJQDeMRoPG9ZzEK+XbPhWpD6GKQ7eGyz4OQnCRswm2P4L9LId/SlWXM/E/uBZus+ZC8iYMCiVeRJ8vUxtKMcLdmGl7hyzFTJHtCGVdTCgWnt/CA4dYCyqPmSSrmOOk67GwFrRaogngMmwWP7opBH/ysgZblUV2vciByPI8ZTnhL9AraAfESrkVHLB7cOSvfHWS4FCv0ygivUmjYPX5ngb3igiZImwguMhoydW9AJDHTGSHBqIv8sRXnM6spEyJo2zkf1X2ECVPyHaPytpIFTsyic0AFFMTbZcOuI52vuTbbRYbn72qrKsdroku9LbROAAJutLZ/m7uScy5vQPyXBwRP1CYzYKaBe1cYYdnt0Mf8vADa0glW+ghmEzL3ZDr06D8HMsJFm5XhLafMAGg3ixgQhWPm/ApCP+kRyyH3mOh+Dt1Spr+Ci2vsrkUJoyxg=
